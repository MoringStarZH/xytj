"use strict";(self["webpackChunkxytj"]=self["webpackChunkxytj"]||[]).push([[642],{3642:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("el-container",[t("el-header",[t("div",{attrs:{id:"header_logo"},on:{click:e.goHome}},[t("img",{attrs:{src:s(6949),alt:""}}),t("span",{staticClass:"ccxkt"},[e._v("西柚碳迹")])]),t("div",[t("div",{staticClass:"time_container"},[e._v(e._s(e.dateYear)+" "+e._s(e.dateDay))]),t("el-popover",{staticClass:"avater_container",attrs:{placement:"bottom",trigger:"hover"},model:{value:e.userInfoVisible,callback:function(t){e.userInfoVisible=t},expression:"userInfoVisible"}},[t("p",{on:{click:function(t){e.changeVisible=!0}}},[e._v("修改密码")]),t("el-divider"),t("p",{on:{click:e.logout}},[e._v("退出登录")]),t("div",{staticClass:"userInfo",attrs:{slot:"reference"},slot:"reference"},[t("img",{attrs:{src:s(7889),alt:""}})])],1)],1)]),t("el-container",[t("el-aside",{attrs:{width:e.isCollapse?"64px":"200px"}},[t("div",{staticClass:"toggle-button",on:{click:e.toggleCollapse}},[e._v("|||")]),t("el-menu",{attrs:{"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b",collapse:e.isCollapse,"collapse-transition":!1,router:"","default-active":e.activeIndex},on:{select:e.handleSelect}},[t("el-submenu",{attrs:{index:"1"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-user-solid"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("账户管理")])]),t("el-menu-item",{attrs:{index:"1-1",route:"admin"}},[t("i",{staticClass:"el-icon-s-tools"}),t("span",[e._v("管理员")])]),t("el-menu-item",{attrs:{index:"1-2",route:"user"}},[t("i",{staticClass:"el-icon-s-unfold"}),t("span",[e._v("用户")])])],2),t("el-menu-item",{attrs:{index:"2",route:"order"}},[t("i",{staticClass:"el-icon-suitcase"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("骑行记录")])]),t("el-menu-item",{attrs:{index:"3",route:"categories"}},[t("i",{staticClass:"el-icon-goods"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("商品管理")])]),t("el-menu-item",{attrs:{index:"4",route:"chain"}},[t("i",{staticClass:"el-icon-share"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("区块链溯源")])]),t("el-menu-item",{attrs:{index:"5",route:"chart"}},[t("i",{staticClass:"el-icon-pie-chart"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("碳足迹分析")])])],1)],1),t("el-main",[t("router-view")],1)],1),t("el-dialog",{attrs:{title:"修改密码",visible:e.changeVisible,width:"30%"},on:{"update:visible":function(t){e.changeVisible=t},close:e.changeDialogClosed}},[t("el-form",{ref:"changeFormRef",attrs:{model:e.changeForm,rules:e.changeFormRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"旧密码",prop:"oldPassword"}},[t("el-input",{model:{value:e.changeForm.oldPassword,callback:function(t){e.$set(e.changeForm,"oldPassword",t)},expression:"changeForm.oldPassword"}})],1),t("el-form-item",{attrs:{label:"新密码",prop:"newPassword1"}},[t("el-input",{model:{value:e.changeForm.newPassword1,callback:function(t){e.$set(e.changeForm,"newPassword1",t)},expression:"changeForm.newPassword1"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"newPassword2"}},[t("el-input",{model:{value:e.changeForm.newPassword2,callback:function(t){e.$set(e.changeForm,"newPassword2",t)},expression:"changeForm.newPassword2"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.changeVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitNewPassword}},[e._v("确 定")])],1)],1)],1)},o=[],r=(s(3722),s(3834)),i={name:"Home",data(){return{isCollapse:!1,userInfoVisible:!1,changeVisible:!1,timer:null,dateDay:null,activeIndex:"/user",dateYear:null,changeForm:{oldPassword:"123456",newPassword1:"123456",newPassword2:"123456"},changeFormRules:{oldPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPassword1:[{required:!0,message:"请输入新密码",trigger:"blur"}],newPassword2:[{required:!0,message:"请再一次输入新密码",trigger:"blur"}]}}},watch:{activeIndex(e){}},methods:{logout(){window.sessionStorage.clear(),this.$router.push("/login")},toggleCollapse(){this.isCollapse=!this.isCollapse},async submitNewPassword(){this.$refs.changeFormRef.validate((async e=>{if(!e)return;if(this.changeForm.newPassword1!==this.changeForm.newPassword2)return void this.$message.error("新旧密码不一致");const t=await(0,r.hA)(window.sessionStorage.getItem("id"));if(0===t.code)return this.$message.error("获取账户信息失败");if(md5(this.changeForm.oldPassword)!==t.data.password)return this.$message.error("密码错误，请检查输入");t.data.password=this.changeForm.newPassword1;const s=await(0,r.aq)(t.data);if(0===s.code)return this.$message.error("修改失败");this.$message.success("修改成功"),this.changeVisible=!1}))},changeDialogClosed(){this.$refs.changeFormRef.resetFields()},goHome(){this.$router.push("home")},handleSelect(e){sessionStorage.setItem("keyPath",e)}},mounted(){this.activeIndex=sessionStorage.getItem("keyPath")||"1",this.timer=setInterval((()=>{const e=this.$dayjs(new Date);this.dateDay=e.format("HH:mm:ss"),this.dateYear=e.format("YYYY-MM-DD")}),1e3)},beforeDestroy(){this.timer&&clearInterval(this.timer)},created(){}},l=i,n=s(5395),c=(0,n.Z)(l,a,o,!1,null,"63f361a8",null),d=c.exports},7889:function(e,t,s){e.exports=s.p+"img/avatar.f3fcfb46.png"},6949:function(e,t,s){e.exports=s.p+"img/logo.b55a585f.png"}}]);
//# sourceMappingURL=642.2620c63a.js.map